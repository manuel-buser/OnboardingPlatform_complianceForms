<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
  :root {
    --primary-color: #999;
  }

  body {
    font-family: Arial, Helvetica, sans-serif;
    line-height: 1.4;
    padding: 0;
    margin: 0;
    background-color: #fff;
  }

  .inside {
    /* Removed background-color property to inherit body's background */
    padding: 4rem 6rem;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  .signature-pad-form {
    max-width: 300px;
    margin: 0 auto;
  }

  .signature-pad {
    border: 2px solid var(--primary-color);
    border-radius: 4px;
  }

  .clear-button {
    color: var(--primary-color);
  }

  @media (pointer: coarse) {
    body {
      overflow: hidden;
    }
  }

  input[type="checkbox"] {
    margin-right: 15px;
  }

  label {
    display: block;
    margin-bottom: 10px;
  }
</style>

</head>

<body>
<div class="inside">
    <div class="container">
        <form id="selfDisclosureForm" th:object="${SelfDisclosure}" class="row">

            <!-- US - Person Questions -->

<h3>2. Indizien bezüglich Qualifizierung als US-Person</h3>
<label>
    Ist die oben, unter Ziff. 1 genannte Person ein US-Staatsbürger? Auf die genannte Person treffen folgende Merkmale zu (bitte Fragen durch Ankreuzen beantworten):
</label><br/>

<label>
    <input type="checkbox" name="usCitizen"/>
    a) Sind Sie im Besitz der US-Staatsbürgerschaft? Sie müssen ebenfalls mit „Ja“ antworten, falls Sie die US-Staatsbürgerschaft als eine
    von mehreren Staatsbürgerschaften besitzen.

</label><br/>

<label>
    <input type="checkbox" name="bornInUSTerritories"/>
    b) Sind Sie in den USA (oder in einem der US Territorien) geboren? US Territorien: Amerikanisch-Samoa und Swains Island, Guam, Commonwealth der
    Nördlichen Marianen, Puerto Rico, US Virgin Islands.

</label><br/>

<label>
    <input type="checkbox" name="hasCertificateOfLossOfNationality"/>
    c) Sofern die Frage b) angekreuzt wurde: Sind Sie im Besitz eines Dokumentes, welches die definitive Aufgabe der US-Staatsbürgerschaft beweist („Certificate of Loss of Nationality“) und verfügen Sie über einen nicht-amerikanischen Pass oder einen anderen behördlich ausgestellten Ausweis, der Ihre Staatsbürgerschaft eines anderen Staates als der USA bestätigt?
</label><br/>

<label>
    <input type="checkbox" name="hasGreenCard"/>
    d) Sind sie im Besitz einer gültigen amerikanischen „Green Card“?
</label><br/>

<label>
    <input type="checkbox" name="hasUSImmigrationServiceCard"/>
    e) Sind Sie im Besitz einer von der US-Amerikanischen Einwanderungs- und Einbürgerungs-behörde (US Citizenship and Immigration Services, USCIS) gültig ausgestellten Ausländer-Registrierungs-Karte für permanent niederlassungsberechtigte Personen?
</label><br/>

<label>
    <input type="checkbox" name="hasUSResidenceForTax"/>
    f) Haben Sie aus US-steuerlicher Sicht Wohnsitz in den USA? Sie gelten als in den USA steuerlich ansässig, wenn Sie den Substantial Presence Test erfüllen. Sie erfüllen diesen Test, wenn sie sich im laufenden Jahr während mindestens 183 Tagen oder, falls weniger aber bereits während mindestens 31 Tagen in den USA aufhalten, gemäss folgender Formel: (Anzahl Tage im laufenden Jahr x 1) + (Anzahl Tage im vorhergehenden Jahr x 1/3) + (Anzahl Tage im zweiten vorhergehenden Jahr x 1/6) ≥ 183 Tage

</label><br/>

<label>
    <input type="checkbox" name="isUSResidentForOtherReasons"/>
    g) Sind Sie aus einem anderen Grund in den USA unbeschränkt steuerpflichtig? Beispielsweise aufgrund bestimmter Visa (E, L, B-I, HI-B), welche möglicherweise eine unbeschränkte Steuerpflicht auslösen. Ebenfalls kann eine abgelaufene Green Card, welche nicht ordnungsgemäss retourniert wurde, zu einer unbeschränkten Steuerpflicht führen.

</label><br/>
<label>
    Ist eine oder sind mehrere Fragen (mit Ausnahme von c) angekreuzt worden, wird die unterzeichnende Person gebeten, zusätzlich das Formular W-9 auszufüllen und zu unterzeichnen.

</label><br/>

            <!-- Tax and PEP Questions -->


            <h3>3. Steuerliche Ansässigkeit in einem EU-Mitgliedstaat</h3>
<label>
    Haben Sie eine steuerliche Ansässigkeit in einem EU-Mitgliedstaat?
    <input type="checkbox" name="euTaxResidency"/>
</label><br/>
<label>
    Falls Sie die Frage mit „Ja“ beantwortet haben, bestätigen Sie hiermit, dass Sie über die EU-Steuer-
    transparenzrichtlinie 2018/822/EU DAC6 unterrichtet wurden und Ihnen das Kunden-Informations-
    schreiben EU-Steuertransparenzrichtlinie DAC6 der CorPa Treuhand AG ausgehändigt wurde.
</label><br/>


            <h3>4. Steuerliche Ansässigkeit in UK</h3>
<label>
    Haben Sie eine steuerliche Ansässigkeit in UK?
    <input type="checkbox" name="ukTaxResidency"/>
</label><br/>
<label>
    Falls Sie die Frage mit „Ja“ beantwortet haben, bestätigen Sie hiermit, dass Sie über die Richtlinie
    der Liechtensteinischen Treuhandkammer zur Vorgehensweise bei der Gründung und Verwaltung
    von Rechtsträgern für UK Personen unterrichtet wurden.
</label><br/>

<h3>5. Politisch exponierte Person (PEP)</h3>
<label>
    Sind Sie eine politisch exponierte Person (PEP)?
    <input type="checkbox" name="politicallyExposedPerson"/>
</label><br/>
<label>
    Falls ja, in welchem/r Amt/Funktion?
    <input type="text" name="pepAssociatedPosition"/>
</label><br/>
<label>
    Haben Sie ein Naheverhältnis (unmittelbares Familienmitglied, enge Geschäftsbeziehung, sozial oder politisch enge Verbundenheit) zu einer politisch exponierten Person?
    <input type="checkbox" name="relatedToPep"/>
</label><br/>
<label>
    Falls im Naheverhältnis, Art/Name/Vorname der nahestehenden Person, Amt und Funktion?
    <input type="text" name="relatedPersonDetails"/>
</label><br/>

<h3>6. Rechtliche Hinweise und Steuerkonformitätserklärung</h3>
<p>
    Eine vorsätzlich oder fahrlässig falsch erteilte Selbstauskunft ist strafbar. Selbiges gilt, wenn Änderungen der Gegebenheiten nicht mitgeteilt werden oder über Änderungen der Gegebenheiten falsche Angaben gemacht werden.
</p>
<p>
    Mit meiner Unterschrift bestätige ich, dass alle von mir gemachten Angaben richtig und vollständig sind. Ich verpflichte mich, allfällige Änderungen unaufgefordert und unverzüglich CorPa Treuhand AG schriftlich mitzuteilen.
</p>
<p>
    Ich bestätigt zudem, dass die im Zusammenhang mit dem Mandat eingebrachten/geschenkten/übertragenen Vermögenswerte und/oder die daraus erzielten Einkünfte und Gewinne bei allen zuständigen Steuerbehörden, insbesondere in meinem steuer-lichen Domizilland, deklariert worden sind und weiterhin von mir deklariert werden.
</p>
<p>
    Ich habe keine Steuerhinterziehung, Geldwäsche oder andere Strafdelikte begangen und bin diesbezüglich nicht in einem Ge-richts- oder Verwaltungsverfahren verurteilt worden. Die im Zusammenhang mit dem Mandat eingebrach-ten/geschenkten/übertragenen Vermögenswerte und/oder die daraus erzielten Einkünfte und Gewinne sind keine Erlöse aus Steuerkriminalität oder sonstigen kriminellen Machenschaften.
</p>

            <div>
                <label for="currentPlace">Aktueller Ort:</label>
                <input type="text" id="currentPlace" name="currentPlace" placeholder="Ort eingeben" />
                <p>Unterschreiben Sie bitte im nachfolgenden Feld.</p>
                <p><b>Unterschrift:</b></p>
                <canvas height="100" width="300" class="signature-pad"></canvas>
                <p>
                    <a href="#" class="clear-button" onclick="clearCanvas()">Clear</a>
                </p>

                <!-- Buttons -->
                <div>
                    <button type="button" onclick="saveData()">Save Data</button>
                    <br> <!-- Line break to ensure buttons are vertically spaced -->
                    <button type="button" onclick="generatePDF()">Generate PDF</button>
                    <br> <!-- Line break to ensure buttons are vertically spaced -->
                    <button type="button" onclick="navigateNext()">Next Page</button>
                </div>
            </div>

            <!-- Add a hidden input field to pass the customerId to the PDF generation form -->
            <div>
                <input type="hidden" id="customerId" th:value="${customerId}" />
                <input type="hidden" id="selfDisclosureId" th:value="${selfDisclosureId}" />
            </div>


        </form>
    </div>
</div>


<script>

const canvas = document.querySelector('canvas');
const ctx = canvas.getContext('2d');
let isDrawing = false;
let lastX = 0;
let lastY = 0;

function draw(e) {
  if (!isDrawing) return;
  ctx.lineWidth = 2;
  ctx.lineCap = 'round';
  ctx.strokeStyle = '#000'; // Set the stroke style to black

  ctx.beginPath();
  // Start from
  ctx.moveTo(lastX, lastY);
  // Go to
  ctx.lineTo(e.offsetX, e.offsetY);
  ctx.stroke();
  [lastX, lastY] = [e.offsetX, e.offsetY];
}

canvas.addEventListener('mousedown', (e) => {
  isDrawing = true;
  [lastX, lastY] = [e.offsetX, e.offsetY];
});

canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', () => isDrawing = false);
canvas.addEventListener('mouseout', () => isDrawing = false);

function clearCanvas() {
    console.log("Clear Button clicked");
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the entire canvas
  }


</script>

<script>
 function saveData() {
    console.log("Save Data Button clicked");

    var form = document.getElementById("selfDisclosureForm");
    var formData = new FormData(form);

    // Convert checkbox values to boolean
    var convertedData = {};
    formData.forEach(function(value, key) {
      if (value === "on") {
        convertedData[key] = true;
      } else {
        convertedData[key] = value;
      }
    });

    var customerId = document.getElementById("customerId").value;

    fetch('/selfDisclosure/add?customerId=' + customerId, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(convertedData),
    })
      .then(response => {
        if (response.ok) {
          console.log("SelfDisclosure Data saved successfully");
        } else {
          console.error('Error:', response.status);
          // Handle error cases here for saving SelfDisclosure data
        }
      })
      .catch(error => {
        console.error('Error saving data:', error);
      });
  }

  function generatePDF() {
    console.log("Generate PDF & Redirect Button clicked");

    var customerId = document.getElementById("customerId").value;
    var selfDisclosureId = document.getElementById("selfDisclosureId").value;
    var currentPlace = document.getElementById("currentPlace").value;

    var signatureDataURL = canvas.toDataURL();
    var encodedSignature = encodeURIComponent(signatureDataURL);

    var data = {
      customerId: parseInt(customerId, 10),
      selfDisclosureId: parseInt(selfDisclosureId, 10),
      signatureImage: encodedSignature,
      currentPlace: currentPlace
    };

    fetch('/selfDisclosure/pdf/generate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
      .then(response => {
        if (response.ok) {
          console.log("PDF generated successfully");
        } else {
          console.error('Error generating PDF:', response.status);
        }
      })
      .catch(error => {
        console.error('Error generating PDF:', error);
      });
  }

  function navigateNext() {
    console.log("Navigating to the next page");
    window.location.href = "/selfDisclosure.html";
  }
</script>
</body>
</html>